# Basic proxy with capture configuration example
name: basic-proxy-capture-api
version: 1.0.0

# Global server configuration
server:
  port: 8080
  host: "0.0.0.0"

# Plugin configuration (replaces old capture handler)
plugins:
  capture_plugin:
    type: "capture"
    config:
      storage_path: "./captures/basic"
      max_requests: 1000
      # Include only API endpoints
      include_patterns:
        - "/api/*"
        - "/v1/*"
      # Exclude health checks and static assets
      exclude_patterns:
        - "/health"
        - "/ping"
        - "*.css"
        - "*.js"
        - "*.png"
        - "*.jpg"
      # Only capture REST methods
      methods:
        - "GET"
        - "POST"
        - "PUT"
        - "DELETE"
        - "PATCH"

endpoints:
  # Proxy endpoint with integrated capture
  api_capture:
    path: "/api/*"
    method: "*"
    mode: proxy
    proxy:
      target: "http://localhost:3000"  # Your actual API server
      capture:
        enabled: true
        auto_start: true
        session_name: "api_capture"
        # Inherits filtering from plugin config
        
  # Mock endpoint for fallback
  fallback:
    path: "/*"
    method: "*"
    mode: mock
    mock:
      status: 404
      body: |
        {
          "error": "Endpoint not found",
          "message": "This endpoint is not configured"
        }
